<!DOCTYPE html>
<html>
<head>
    <title>Claim Policy</title>
    <style>
        .label {
            display: inline-block;
            width: 180px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="file"] {
            width: 250px;
            padding: 6px;
        }

        form p {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

<h2>Policy Claim Form</h2>

<div>
    <p><strong>Policy Name:</strong> <span id="policyName"></span></p>
    <p><strong>Coverage Amount:</strong> <span id="coverageAmount"></span></p>
    <p><strong>Premium:</strong> <span id="premiumAmount"></span></p>
    <p><strong>Status:</strong> <span id="policyStatus"></span></p>
</div>

<hr>

<form>
    <p><span class="label">Location:</span>
        <input type="text" id="location" placeholder="Enter address" readonly
             onclick="window.open('https://www.google.com/maps', '_blank')">
    </p>
    <p><span class="label">Description:</span> <input type="text" id="description"></p>
    <p><span class="label">Claim Amount:</span> <input type="number" id="amount" oninput="validateClaimAmount(this)"></p>
    <p id="claimWarning" style="color: red; display: none;">Claim amount cannot exceed coverage amount.</p>
    <p><span class="label">Claim Date:</span> <input type="date" id="date"></p>
    <p><span class="label">Documents-Front-Right:</span> <input type="file" id="docs1"></p>
    <p><span class="label">Documents-Front-Left:</span> <input type="file" id="docs2"></p>
    <p><span class="label">Documents-Back-Right:</span> <input type="file" id="docs3"></p>
    <p><span class="label">Documents-Back-Left:</span> <input type="file" id="docs4"></p>
    <button type="button" onclick="submitClaim()">Submit Claim</button>
</form>


<script>
    // Fetch policy data securely from backend
    async function loadPolicyData() {
        try {
                const response = await fetch("/get-policy-data", {
                method: "POST",  // ðŸ‘ˆ Changed from GET to POST
                credentials: "include",  // Still required for cookies
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({}),  // Empty body (or add data if needed)
            });

            if (response.ok) {
                const data = await response.json();

                // Display policy info
                document.getElementById('policyName').textContent = data.name;
                document.getElementById('coverageAmount').textContent = data.coverage;
                document.getElementById('premiumAmount').textContent = data.premium;
                document.getElementById('policyStatus').textContent = data.status ? "Active" : "Inactive";
            } else {
                console.error("Failed to load policy data");
            }
        } catch (error) {
            console.error("Error:", error);
        }
    }

    // Load data when page opens
    loadPolicyData();

    //function to not allow claim amount exceed amount coverage amount
    function validateClaimAmount(input) {
        const coverage = parseFloat(document.getElementById("coverageAmount").textContent);
        const claim = parseFloat(input.value);
        const warning = document.getElementById("claimWarning");

        if (!isNaN(claim) && claim > coverage) {
            input.value = coverage;
            warning.style.display = "block";
        } else {
            warning.style.display = "none";
        }
    }
    //claim button
    function submitClaim() {
        alert("Claim submitted!");
        // Add actual submission logic here
    }
</script>

</body>
</html>